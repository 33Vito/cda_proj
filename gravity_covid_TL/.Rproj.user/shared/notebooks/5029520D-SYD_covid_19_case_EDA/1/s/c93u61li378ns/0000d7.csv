"0","plot_map_TL <- function(df, sdf, key_var, fill_var, title_text) {"
"0","  # browser()"
"0","  df['id'] <- unique(fortify(sdf)$id)[match(df[[key_var]], "
"0","                                            sdf[[key_var]])] %>% as.character()"
"0","  sdf_tidy <- fortify(sdf) %>% "
"0","    left_join(df, by=""id"")"
"0","  "
"0","  gg_map <- ggplot(sdf_tidy) +"
"0","    geom_map(inherit.aes = FALSE, alpha=.85,"
"0","             aes_string(map_id = ""id"", fill= fill_var),"
"0","             map = sdf_tidy, col=""grey83"", size=NA) +"
"0","    expand_limits(x = sdf_tidy$long, y = sdf_tidy$lat) +"
"0","    # xlim(150.7,151.48) + ylim(-34.1,-33.5) +"
"0","    # scale_fill_gradient(low=""white"", high=""darkred"") +"
"0","    scale_fill_viridis_c(breaks = pretty_breaks(5)) +"
"0","    scale_alpha_continuous(range = c(0,.3)) +"
"0","    labs(title = title_text) + "
"0","    theme_void() +"
"0","    # theme(legend.position = ""right"")"
"0","    theme(legend.position = c(.93,.15))"
"0","  "
"0","  gg_bar <- df %>% "
"0","    # top_n(20) %>% # There is a bug in top_n()"
"0","    slice_max(order_by = !!as.name(fill_var), n=20) %>% "
"0","    ggplot(aes_string(x=key_var, y=fill_var, fill=fill_var)) + "
"0","    geom_col(width=.8) + "
"0","    geom_text(aes_string(label=fill_var), "
"0","              hjust=0, vjust=.3, size=3.3, col=""black"") + "
"0","    scale_fill_viridis_c(breaks = pretty_breaks(5)) +"
"0","    coord_flip() + "
"0","    xlab("""") + "
"0","    ylim(c(0, 1.1*max(df[[fill_var]], na.rm=T))) + "
"0","    labs(subtitle = paste0(""Top 20 "", key_var)) + "
"0","    ggl() + "
"0","    theme(legend.position = ""none"")"
"0","  "
"0","  gg_map + gg_bar + plot_layout(widths = c(3, 1))"
"0","}"
"0",""
"0","confirmed_cases %>% "
"0","  filter(lga_name19 %in% SYD_LGA$LGA_NAME19) %>% "
"0","  count(lga_name19, name=""Total_cases"") %>% "
"0","  rename(LGA_NAME19 = lga_name19) %>% "
"0","  mutate(LGA_NAME19 = fct_reorder(LGA_NAME19, Total_cases)) %>% "
"0","  plot_map_TL(SYD_LGA, ""LGA_NAME19"", ""Total_cases"", "
"0","           ""Total Covid-19 cases by LGA (SYD Metro)"")"
