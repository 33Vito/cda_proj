confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
ggplot(aes(x=postcode, y=n)) +
geom_col() +
facet_wrap(~lga_name19, scales = "free") +
ggl()
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
ggl()
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
xlim(0,100)
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
xlim(0,100) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~cut(n,0,30,50,Inf)) +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(n_range = cut(n,0,30,50,Inf)) +
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~n_range) +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(n_range = cut(n,0,30,50,Inf))
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(n_range = cut(n, c(0,30,50,Inf))) +
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~n_range) +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(n_range = cut(n, c(0,30,50,Inf))) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~n_range) +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(n_range = cut(n, c(0,30,50,Inf))) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~n_range, scales = "free_x") +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(n_range = cut(n, c(0,10,30,50,Inf))) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~n_range, scales = "free_x") +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(n_range = cut(n, c(0,10,20,30,Inf))) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~n_range, scales = "free_x") +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(n_range = cut(n, c(0,10,20,30,Inf))) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~n_range, scales = "free_x", label = "label_both") +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(n_range = cut(n, c(0,10,20,30,Inf))) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~n_range, scales = "free_x", label = "label_both") +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
count(lga_name19, postcode) %>%
mutate(lga_name19 = fct_reorder(lga_name19, -n, .fun = sum)) %>%
# arrange(lga_name19) %>%
mutate(case_range = cut(n, c(0,10,20,30,Inf))) %>%
ggplot(aes(x=n, col=lga_name19)) +
geom_density() +
facet_wrap(~case_range, scales = "free_x", label = "label_both") +
# xlim(0,50) +
ggl(lp = "none")
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="count_of_postcode") %>%
ggplot(aes(x=reorder(lga_name19, -count_of_postcode), y=count_of_postcode)) +
geom_col() +
coord_flip() +
ggl()
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="count_of_postcode") %>%
ggplot(aes(x=reorder(lga_name19, count_of_postcode), y=count_of_postcode)) +
geom_col() +
coord_flip() +
ggl()
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="count_of_postcode") %>%
slice_max(n=20, order_by = count_of_postcode) %>%
ggplot(aes(x=reorder(lga_name19, count_of_postcode), y=count_of_postcode)) +
geom_col() +
coord_flip() +
ggl()
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="count_of_postcode") %>%
left_join(confirmed_cases %>% count(lga_name19), by="lga_name19")
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="count_of_postcode") %>%
left_join(confirmed_cases %>% count(lga_name19, name="Total_cases"),
by="lga_name19")
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="Number_of_postcodes") %>%
left_join(confirmed_cases %>% count(lga_name19, name="Total_cases"),
by="lga_name19")
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="Number_of_postcodes") %>%
left_join(confirmed_cases %>% count(lga_name19, name="Total_cases"),
by="lga_name19") %>%
slice_max(n=30, order_by = Total_cases) %>%
gather(key, value, -lga_name19) %>%
ggplot(aes(x=reorder(lga_name19, value), y=value)) +
geom_col() +
facet_wrap(~key) +
coord_flip() +
ggl()
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="Number_of_postcodes") %>%
left_join(confirmed_cases %>% count(lga_name19, name="Total_cases"),
by="lga_name19") %>%
slice_max(n=30, order_by = Total_cases) %>%
gather(key, value, -lga_name19) %>%
ggplot(aes(x=reorder(lga_name19, value), y=value)) +
geom_col() +
facet_wrap(~key, scales = "free_y") +
coord_flip() +
ggl()
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="Number_of_postcodes") %>%
left_join(confirmed_cases %>% count(lga_name19, name="Total_cases"),
by="lga_name19") %>%
slice_max(n=30, order_by = Total_cases) %>%
gather(key, value, -lga_name19) %>%
ggplot(aes(x=reorder(lga_name19, value), y=value)) +
geom_col() +
facet_wrap(~key, scales = "free_x") +
coord_flip() +
ggl()
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="Number_of_postcodes") %>%
left_join(confirmed_cases %>% count(lga_name19, name="Total_cases"),
by="lga_name19") %>%
slice_max(n=30, order_by = Total_cases) %>%
gather(key, value, -lga_name19) %>%
ggplot(aes(x=reorder(lga_name19, value), y=value)) +
geom_col() +
facet_wrap(~key, scales = "free_x") +
coord_flip() +
xlab("") +
ggl()
confirmed_cases %>%
distinct(lga_name19, postcode) %>%
count(lga_name19, name="Number_of_postcodes") %>%
left_join(confirmed_cases %>% count(lga_name19, name="Total_cases"),
by="lga_name19") %>%
slice_max(n=30, order_by = Total_cases) %>%
gather(key, value, -lga_name19) %>%
ggplot(aes(x=reorder(lga_name19, value), y=value)) +
geom_col() +
facet_wrap(~key, scales = "free_x") +
coord_flip() +
xlab("") + ylab("") +
ggl()
confirmed_cases %>%
filter(postcode != 2026) %>%
filter(as.character(postcode) %in% SYD_POA$POA_NAME16) %>%
count(postcode, name="Total_cases") %>%
rename(POA_NAME16 = postcode) %>%
mutate(POA_NAME16 = fct_reorder(as.factor(POA_NAME16), Total_cases)) %>%
plot_map_TL(SYD_POA, "POA_NAME16", "Total_cases",
"Total Covid-19 cases by POA (SYD Metro), excluding POA 2026")
confirmed_cases %>%
filter(!(postcode %in% c(2026, 2145))) %>%
filter(as.character(postcode) %in% SYD_POA$POA_NAME16) %>%
count(postcode, name="Total_cases") %>%
rename(POA_NAME16 = postcode) %>%
mutate(POA_NAME16 = fct_reorder(as.factor(POA_NAME16), Total_cases)) %>%
plot_map_TL(SYD_POA, "POA_NAME16", "Total_cases",
"Total Covid-19 cases by POA (SYD Metro), excluding POA 2026, 2145")
plot_map_TL <- function(df, sdf, key_var, fill_var, title_text) {
# browser()
df['id'] <- unique(fortify(sdf)$id)[match(df[[key_var]],
sdf[[key_var]])] %>% as.character()
sdf_tidy <- fortify(sdf) %>%
left_join(df, by="id")
gg_map <- ggplot(sdf_tidy) +
geom_map(inherit.aes = FALSE, alpha=.85,
aes_string(map_id = "id", fill= fill_var),
map = sdf_tidy, col="grey83", size=NA) +
expand_limits(x = sdf_tidy$long, y = sdf_tidy$lat) +
# xlim(150.7,151.48) + ylim(-34.1,-33.5) +
# scale_fill_gradient(low="white", high="darkred") +
scale_fill_viridis_c(breaks = pretty_breaks(5)) +
scale_alpha_continuous(range = c(0,.3)) +
labs(title = title_text) +
theme_void() +
# theme(legend.position = "right")
theme(legend.position = c(.93,.15))
gg_bar <- df %>%
# top_n(20) %>% # There is a bug in top_n()
slice_max(order_by = !!as.name(fill_var), n=20) %>%
ggplot(aes_string(x=key_var, y=fill_var, fill=fill_var)) +
geom_col(width=.8) +
geom_text(aes_string(label=fill_var),
hjust=0, vjust=.3, size=3.3, col="black") +
scale_fill_viridis_c(breaks = pretty_breaks(5)) +
coord_flip() +
xlab("") +
ylim(c(0, 1.1*max(df[[fill_var]], na.rm=T))) +
labs(subtitle = paste0("Top 20 ", key_var)) +
ggl() +
theme(legend.position = "none")
gg_map + gg_bar + plot_layout(widths = c(3, 1))
}
confirmed_cases %>%
filter(lga_name19 %in% SYD_LGA$LGA_NAME19) %>%
count(lga_name19, name="Total_cases") %>%
rename(LGA_NAME19 = lga_name19) %>%
mutate(LGA_NAME19 = fct_reorder(LGA_NAME19, Total_cases)) %>%
plot_map_TL(SYD_LGA, "LGA_NAME19", "Total_cases",
"Total Covid-19 cases by LGA (SYD Metro)")
confirmed_cases %>%
filter(as.character(postcode) %in% SYD_POA$POA_NAME16) %>%
count(postcode, name="Total_cases") %>%
rename(POA_NAME16 = postcode) %>%
mutate(POA_NAME16 = fct_reorder(as.factor(POA_NAME16), Total_cases)) %>%
plot_map_TL(SYD_POA, "POA_NAME16", "Total_cases",
"Total Covid-19 cases by POA (SYD Metro)")
confirmed_cases %>%
filter(!(postcode %in% c(2026, 2145))) %>%
filter(as.character(postcode) %in% SYD_POA$POA_NAME16) %>%
count(postcode, name="Total_cases") %>%
rename(POA_NAME16 = postcode) %>%
mutate(POA_NAME16 = fct_reorder(as.factor(POA_NAME16), Total_cases)) %>%
plot_map_TL(SYD_POA, "POA_NAME16", "Total_cases",
"Total Covid-19 cases by POA (SYD Metro), excluding POA 2026, 2145")
confirmed_cases %>%
filter(!(postcode %in% c(2026, 2145, 2170))) %>%
filter(as.character(postcode) %in% SYD_POA$POA_NAME16) %>%
count(postcode, name="Total_cases") %>%
rename(POA_NAME16 = postcode) %>%
mutate(POA_NAME16 = fct_reorder(as.factor(POA_NAME16), Total_cases)) %>%
plot_map_TL(SYD_POA, "POA_NAME16", "Total_cases",
"Total Covid-19 cases by POA (SYD Metro), excluding POA 2026, 2145")
confirmed_cases %>%
filter(!(postcode %in% c(2026, 2145, 2170))) %>%
filter(as.character(postcode) %in% SYD_POA$POA_NAME16) %>%
count(postcode, name="Total_cases") %>%
rename(POA_NAME16 = postcode) %>%
mutate(POA_NAME16 = fct_reorder(as.factor(POA_NAME16), Total_cases)) %>%
plot_map_TL(SYD_POA, "POA_NAME16", "Total_cases",
"Total Covid-19 cases by POA (SYD Metro), excluding top 3 POA: 2026, 2145, 2170")
confirmed_cases %>%
filter(!(postcode %in% c(2026, 2145, 2170))) %>%
filter(as.character(postcode) %in% SYD_POA$POA_NAME16) %>%
count(postcode, name="Total_cases") %>%
rename(POA_NAME16 = postcode) %>%
mutate(POA_NAME16 = fct_reorder(as.factor(POA_NAME16), Total_cases)) %>%
plot_map_TL(SYD_POA, "POA_NAME16", "Total_cases",
"Total Covid-19 cases by POA (SYD Metro), excluding top 3 POA")
confirmed_cases %>%
filter(str_detect(lga_name19, "Sydney")) %>%
count(lhd_2010_name, postcode, notification_date) %>%
group_by(lhd_2010_name, postcode) %>%
mutate(days_since_first_case = notification_date - min(notification_date)) %>%
mutate(accumulated_cases = cumsum(n)) %>%
mutate(lab=ifelse(notification_date == max(notification_date), postcode, NA)) %>%
ggplot(aes(x=days_since_first_case , y=accumulated_cases,
group=postcode,
col=lhd_2010_name)) +
# geom_point() +
geom_line() +
geom_text(aes(label=lab), size=1) +
facet_wrap(~lhd_2010_name, scales = "free_y") +
labs(subtitle = "Accumulated confirmed Covid-19 cases (NSW), by postcode") +
xlim(c(0,550)) +
ggl(lp = "none", )
confirmed_cases %>%
filter(str_detect(lga_name19, ".*Sydney.*")) %>%
count(lhd_2010_name, postcode, notification_date) %>%
group_by(lhd_2010_name, postcode) %>%
mutate(days_since_first_case = notification_date - min(notification_date)) %>%
mutate(accumulated_cases = cumsum(n)) %>%
mutate(lab=ifelse(notification_date == max(notification_date), postcode, NA)) %>%
ggplot(aes(x=days_since_first_case , y=accumulated_cases,
group=postcode,
col=lhd_2010_name)) +
# geom_point() +
geom_line() +
geom_text(aes(label=lab), size=1) +
facet_wrap(~lhd_2010_name, scales = "free_y") +
labs(subtitle = "Accumulated confirmed Covid-19 cases (NSW), by postcode") +
xlim(c(0,550)) +
ggl(lp = "none", )
confirmed_cases %>%
filter(lga_name19 %in% c("South Eastern Sydney",
"Northern Sydney",
"Western Sydney",
"South Western Sydney",
"Sydney")) %>%
count(lhd_2010_name, postcode, notification_date) %>%
group_by(lhd_2010_name, postcode) %>%
mutate(days_since_first_case = notification_date - min(notification_date)) %>%
mutate(accumulated_cases = cumsum(n)) %>%
mutate(lab=ifelse(notification_date == max(notification_date), postcode, NA)) %>%
ggplot(aes(x=days_since_first_case , y=accumulated_cases,
group=postcode,
col=lhd_2010_name)) +
# geom_point() +
geom_line() +
geom_text(aes(label=lab), size=1) +
facet_wrap(~lhd_2010_name, scales = "free_y") +
labs(subtitle = "Accumulated confirmed Covid-19 cases (NSW), by postcode") +
xlim(c(0,550)) +
ggl(lp = "none", )
confirmed_cases %>%
filter(lga_name19 %in% c("South Eastern Sydney",
"Northern Sydney",
"Western Sydney",
"South Western Sydney",
"Sydney"))
confirmed_cases
confirmed_cases %>%
filter(lhd_2010_name %in% c("South Eastern Sydney",
"Northern Sydney",
"Western Sydney",
"South Western Sydney",
"Sydney")) %>%
count(lhd_2010_name, postcode, notification_date) %>%
group_by(lhd_2010_name, postcode) %>%
mutate(days_since_first_case = notification_date - min(notification_date)) %>%
mutate(accumulated_cases = cumsum(n)) %>%
mutate(lab=ifelse(notification_date == max(notification_date), postcode, NA)) %>%
ggplot(aes(x=days_since_first_case , y=accumulated_cases,
group=postcode,
col=lhd_2010_name)) +
# geom_point() +
geom_line() +
geom_text(aes(label=lab), size=1) +
facet_wrap(~lhd_2010_name, scales = "free_y") +
labs(subtitle = "Accumulated confirmed Covid-19 cases (NSW), by postcode") +
xlim(c(0,550)) +
ggl(lp = "none", )
confirmed_cases %>%
filter(lhd_2010_name %in% c("South Eastern Sydney",
"Northern Sydney",
"Western Sydney",
"South Western Sydney",
"Sydney") | is.na(lhd_2010_name)) %>%
count(lhd_2010_name, postcode, notification_date) %>%
group_by(lhd_2010_name, postcode) %>%
mutate(days_since_first_case = notification_date - min(notification_date)) %>%
mutate(accumulated_cases = cumsum(n)) %>%
mutate(lab=ifelse(notification_date == max(notification_date), postcode, NA)) %>%
ggplot(aes(x=days_since_first_case , y=accumulated_cases,
group=postcode,
col=lhd_2010_name)) +
# geom_point() +
geom_line() +
geom_text(aes(label=lab), size=1) +
facet_wrap(~lhd_2010_name, scales = "free_y") +
labs(subtitle = "Accumulated confirmed Covid-19 cases (NSW), by postcode") +
xlim(c(0,550)) +
ggl(lp = "none", )
confirmed_cases %>%
filter(lhd_2010_name %in% c("South Eastern Sydney",
"Northern Sydney",
"Western Sydney",
"South Western Sydney",
"Sydney") | is.na(lhd_2010_name)) %>%
count(lhd_2010_name, postcode, notification_date) %>%
group_by(lhd_2010_name, postcode) %>%
mutate(days_since_first_case = notification_date - min(notification_date)) %>%
mutate(accumulated_cases = cumsum(n)) %>%
mutate(lab=ifelse(notification_date == max(notification_date), postcode, NA)) %>%
ggplot(aes(x=days_since_first_case , y=accumulated_cases,
group=postcode,
col=lhd_2010_name)) +
# geom_point() +
geom_line() +
geom_text(aes(label=lab), size=1) +
facet_wrap(~lhd_2010_name, scales = "free_y") +
labs(subtitle = "Accumulated confirmed Covid-19 cases (NSW), by postcode") +
xlim(c(0,550)) +
ggl(lp = "none", )
confirmed_cases %>%
filter(lhd_2010_name %in% c("South Eastern Sydney",
"Northern Sydney",
"Western Sydney",
"South Western Sydney",
"Sydney") | is.na(lhd_2010_name)) %>%
count(lhd_2010_name, postcode, notification_date) %>%
group_by(lhd_2010_name, postcode) %>%
mutate(days_since_first_case = notification_date - min(notification_date)) %>%
mutate(accumulated_cases = cumsum(n)) %>%
mutate(lab=ifelse(notification_date == max(notification_date), postcode, NA)) %>%
ggplot(aes(x=days_since_first_case , y=accumulated_cases,
group=postcode,
col=lhd_2010_name)) +
# geom_point() +
geom_line() +
geom_text(aes(label=lab), size=3) +
facet_wrap(~lhd_2010_name, scales = "free_y") +
labs(subtitle = "Accumulated confirmed Covid-19 cases (NSW), by postcode") +
xlim(c(0,550)) +
ggl(lp = "none", )
1
confirmed_cases %>%
filter(lhd_2010_name %in% c("South Eastern Sydney",
"Northern Sydney",
"Western Sydney",
"South Western Sydney",
"Sydney") | is.na(lhd_2010_name)) %>%
count(lhd_2010_name, postcode, notification_date) %>%
group_by(lhd_2010_name, postcode) %>%
mutate(days_since_first_case = notification_date - min(notification_date)) %>%
mutate(accumulated_cases = cumsum(n)) %>%
mutate(lab=ifelse(notification_date == max(notification_date), postcode, NA)) %>%
ggplot(aes(x=days_since_first_case , y=accumulated_cases,
group=postcode,
col=lhd_2010_name)) +
# geom_point() +
geom_line() +
geom_text(aes(label=lab), size=3) +
facet_wrap(~lhd_2010_name, scales = "free_y") +
labs(subtitle = "Accumulated confirmed Covid-19 cases (Sydney), by postcode") +
xlim(c(0,550)) +
ggl(lp = "none", )
